To create sum and scaled table with SQL only
WITH temp2 as
(select country_name,state_name,year_name,sum(cast(gdp as numeric(10,1))) as gdp_mm
 from 
economy_gdp_by_state 
	WHERE year_name='2024'
	group by country_name,state_name,year_name),
temp2_minmaxrange as
(SELECT cast(min(gdp_mm) as numeric(10,1)) as min,cast(max(gdp_mm) as numeric(10,1)) as max,cast(max(gdp_mm)-min(gdp_mm) as numeric(10,1)) as range
	FROM temp2)
select 
	temp2.country_name,temp2.state_name,temp2.year_name, temp2.gdp_mm
 ,cast((temp2.gdp_mm-temp2_minmaxrange.min)*100/temp2_minmaxrange.range as numeric(10,1))  as rank
	,temp2_minmaxrange.min,temp2_minmaxrange.max,temp2_minmaxrange.range  
 from 
	temp2_minmaxrange, temp2
	 order by rank desc;
